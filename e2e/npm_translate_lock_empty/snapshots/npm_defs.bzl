"""@generated by npm_translate_lock(name = "npm", pnpm_lock = "@@//:pnpm-lock.yaml")"""

load("@npm__debug__4.4.3__links//:defs.bzl", store_0 = "npm_imported_package_store_internal")
load("@npm__ms__2.1.3__links//:defs.bzl", store_1 = "npm_imported_package_store_internal")

# buildifier: disable=bzl-visibility
load("@aspect_rules_js//js:defs.bzl", _js_library = "js_library")

_IMPORTER_PACKAGES = [""]

# buildifier: disable=function-docstring
def npm_link_all_packages(name = "node_modules", imported_links = [], prod = True, dev = True):
    if name != "node_modules":
        fail("npm_link_all_packages: customizing 'name' is not supported")
    if not prod and not dev:
        fail("npm_link_all_packages: at least one of 'prod' or 'dev' must be True")

    bazel_package = native.package_name()
    root_package = ""
    is_root = bazel_package == root_package
    is_importer = bazel_package in _IMPORTER_PACKAGES
    if not is_root and not is_importer:
        msg = "The npm_link_all_packages() macro loaded from @npm//:defs.bzl and called in bazel package '%s' may only be called in bazel packages that correspond to the pnpm root package or pnpm workspace projects. Projects are discovered from the pnpm-lock.yaml and may be missing if the lockfile is out of date. Root package: '', pnpm workspace projects: %s" % (bazel_package, "'" + "', '".join(_IMPORTER_PACKAGES) + "'")
        fail(msg)

    if is_root:
        store_0()
        store_1()

    link_targets = None
    scope_targets = None

    for link_fn in imported_links:
        new_link_targets, new_scope_targets = link_fn(name, prod, dev)
        if not link_targets:
            link_targets = []
        link_targets.extend(new_link_targets)
        for _scope, _targets in new_scope_targets.items():
            if not scope_targets:
                scope_targets = {}
            if _scope not in scope_targets:
                scope_targets[_scope] = []
            scope_targets[_scope].extend(_targets)

    if scope_targets:
        for scope, scoped_targets in scope_targets.items():
            _js_library(
                name = "node_modules/{}".format(scope),
                srcs = scoped_targets,
                tags = ["manual"],
                visibility = ["//visibility:public"],
            )

    if is_importer:
        _js_library(
            name = "node_modules",
            srcs = link_targets if link_targets else [],
            tags = ["manual"],
            visibility = ["//visibility:public"],
        )

# buildifier: disable=function-docstring
def npm_link_targets(name = "node_modules", package = None, prod = True, dev = True):
    if name != "node_modules":
        fail("npm_link_targets: customizing 'name' is not supported")
    if not prod and not dev:
        fail("npm_link_targets: at least one of 'prod' or 'dev' must be True")

    bazel_package = package if package != None else native.package_name()

    link_targets = []

    return link_targets
