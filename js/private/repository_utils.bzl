"""
Repository rule utilities.
"""

def _config_settings_impl(rctx):
    v = native.bazel_version.split(".")
    is_less_than_6_3 = len(v) > 1 and v[0].isdigit() and (int(v[0]) < 6 or (int(v[0]) == 6 and v[1].isdigit() and int(v[1]) < 3))

    prop = "allow_unresolved_symlinks"
    if is_less_than_6_3:
        prop = "experimental_allow_unresolved_symlinks"

    rctx.file("BUILD.bazel", """# @generated by @aspect_rules_js//js/private:repository_utils.bzl

config_setting(
    name = "allow_unresolved_symlinks",
    values = {values},
    visibility = ["//visibility:public"],
)
""".format(values = {prop: "true"}))

config_settings = repository_rule(
    implementation = _config_settings_impl,
    attrs = {},
)
